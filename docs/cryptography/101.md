---
sidebar_position: 1
toc_min_heading_level: 2
toc_max_heading_level: 3
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import { Mermaid } from 'mdx-mermaid/Mermaid'

# Cryptography 101

## Terminology

### General
:::info
 - [Primitive](https://en.wikipedia.org/wiki/Cryptographic_primitive)
 - [Protocol](https://en.wikipedia.org/wiki/Cryptographic_protocol)
 - Cryptographer
 - Cryptanalyst
 - `NIST` [National Institute of Standard and Technology](https://en.wikipedia.org/wiki/National_Institute_of_Standards_and_Technology)
 - `FIPS` [Federal Information Processing Standards](https://en.wikipedia.org/wiki/Federal_Information_Processing_Standards)
 - MITM (Man in the middle) Attack
 - Defense in depth
:::

### Hash function
:::info
#### Input
  - Message
#### Output
  - Digest / Hash
#### Properties
  - Pre-image resistance
    - One way, irreversible
  - Second pre-image resistance
    - Given a fixed input, whether there exists another input that yields the same digest
  - Collision resistance
    - Given any input, there exists a case that 2 inputs yields the same digest
    - Birthday Bound
#### Algorithm
  - `MD5`
  - `SHA1` 
  - `SHA2`
    - Merkie-Damgard
    - Compression Function
    - Length-extension attacks
  - `SHA3` 
    - Permutation
    - Spongy Construction
      - Absorbing
      - Squeezing
    - Random Oracle
  - `SHAKE` `cSHAKE` 
    - XOF - extendable output function
  - `TupleHash` 
  - [`Argon2`](https://en.wikipedia.org/wiki/Argon2)
  - [`PBKDF2`](https://en.wikipedia.org/wiki/PBKDF2)
  - [`bcrypt`](https://en.wikipedia.org/wiki/Bcrypt)
  - [`scrypt`](https://en.wikipedia.org/wiki/Scrypt)
#### Attacks
  - Rainbow table
  - Length-extension attacks
:::



### MAC - Message Authentication Code
:::info
#### Process
  ```mermaid
  graph LR;
      In1[Secret Key]-->func[HMAC];
      In2[Message]-->func;
      func--> Out[Authentication Tag];
  ```
#### Algorithms
  - HMAC
    - SHA2
    - `HMAC-SHA256`
  - KMAC
    - cSHAKE
#### Attacks
  - Timing Attack
  - Replay Attack
#### Use case
  - Message Authentication
  - HKDF - HMAC based key derivation function
  - PRF - Pseudorandom function
  - Cookie authentication tag
  - Hash Table (Programming Languages)
:::

### Symmetric cryptography
:::info
#### a.k.a
  - Secret Key Cryptography
#### Process
  ```mermaid
    graph LR;
        InE1[Secret key]-->funcE[Encryption];
        InE2[Plain text]-->funcE;
        funcE--> OutE[Cipher text];

        InD1[Secret key]-->funcD[Decryption];
        InD2[Cipher text]-->funcD;
        funcD--> OutD[Plain text];
  ```


#### Algorithms
  - AES (Advanced Encryption Standard)
    - Block cipher
    - Permutation
      - State
      - Reversible
    - Deterministic
    - Round function
    - Diffusion
      - Avalanche effect
    - Bit Security      
    - XOR - exclusive OR 
    - `PKCS#7` padding 
  - `AES-ECB` (Electronic codebook)
    - ECB encrypted penguin
  - `AES-CBC` (Cipher block chaining)
    - IV - Initialization Vector
      - unpredicatable, random
      - BEAST (Browser Exploit Against SSL/TLS) attack
  - `AES-CBC-HMAC`
    - Encrypt-then-MAC 
  - AEAD (Authenticated Encryption with Associated Data)
  - [`AES-GCM` (Galois / Counter Mode)](https://en.wikipedia.org/wiki/Galois/Counter_Mode) 
    - AES-CTR
      - Nounce
      - Stream Cipher
    - GMAC
      - AXU - XORed universal hash
      - DUF - Difference unpredictable function
  - [`ChaCha20-Poly1305`](https://en.wikipedia.org/wiki/ChaCha20-Poly1305)
  - [`Adiantum`](https://en.wikipedia.org/wiki/Adiantum_(cipher))
  - [`AES-XTS`](https://en.wikipedia.org/wiki/Disk_encryption_theory#XTS)
:::

### Key exchange
:::info
#### Algorithms
  - `DH` - Diffie-Hellman key exchange
  - `ECDH` - Elliptic Curve Diffie-Hellman key exchange
:::

### Asymmetric cryptography
:::info
#### a.k.a
  - Public key cryptography

#### Process
  ```mermaid
    graph LR;
        InE1[His public key]-->funcE[Encryption];
        InE2[Plain text]-->funcE;
        funcE--> OutE[Cipher text];

        InD1[My private key]-->funcD[Decryption];
        InD2[Cipher text]-->funcD;
        funcD--> OutD[Plain text];
  ```
#### Use Case
  - Hybrid encryption
    - KEM - Key encapsulation mechanism
    - DEM - Data encapsulation mechanism  
#### Algorithms
  - `RSA PKCS#1 v1.5`
    - Million message attack
  - `RSA OAEP`
  - `ECIES` Elliptic Curve Integrated Encryption Scheme 
    - Ephemeral key pair
#### Attacks   
  - Million message attack
:::

### Digital Signature
:::info

#### Scenario: Alice signs, Bob verifies
  ```mermaid
    flowchart TD;        
        keyExchange[DH Key Exchange or RSA Key Generation]-->publicKey[Alice's public key]
        keyExchange-->privateKey[Alice's private key]        
        subgraph Alice signs
          direction LR
          privateKey-->sign[Encryption];
          targetMessage[Target Message]-->sign;
          sign-->signature[Alice's signature];
        end
        subgraph Bob verifies
          direction LR
          publicKey-->decrypt[Decryption];
          signature-->decrypt;
          decrypt-->derivedMessage[Derived Message];
          derivedMessage-->verify{Verify};
          targetMessage-->verify
          verify-->OutV[true or false];
        end
  ```
#### Concept
  - Transitive Trust
  - Zero-knowledge Proof
  - PKI - Public key infrastructure
#### What it provides
  - Message authentication (No one can impersonate you)
  - Non-repudiation (You cant deny the message is not sent by you)
  - Message integrity (No one can tamper the content of message)
#### Algorithms
  - `RSA-PSS` 
  - `ECDSA` Elliptic Curve Digital Signature Algorithm
  - `EdDSA` EdDSA Edwards-curve Digital Signature Algorithm
#### Attacks
  - Substitution attacks
    - Key substitution attacks
    - Message key substitution attacks
  -  Signature malleability
:::

### Randomness / Secrets
:::info
- Entropy
- `TRNG` [True random number generator](https://en.wikipedia.org/wiki/Hardware_random_number_generator)
  - a.k.a: `HRNG` Hardware random number generator
  - Input: Entrophy from physical process
  - Output: Random number
- `PRNG` [Pseudorandom number generator](https://en.wikipedia.org/wiki/Pseudorandom_number_generator)
  - Input: Seed (Need to be uniformly random)
  - Output: Random number
  - Forward / Backward secrecy
  - Can generate a lot of output
- `VRF` [Verifiable random function](https://en.wikipedia.org/wiki/Verifiable_random_function)
  - First, generate key pair
  - Then, generate a seed
  - Then, use VRF
    In
    - Private key
    - **Message** Seed
  - Out
    - **Proof** Signature
      - Sign the seed to produce Signature
    - **Output** Random number 
      - by hashing Seed and produce MAC (Random number)
  - Verification
    - use his public key to verify the seed (Verify)
    - Hash the seed should get the random number (MAC)
  - Problem
    - [Signature scheme do not guarantee uniqueness. Signature is malleable.](https://crypto.stackexchange.com/questions/50681/what-is-the-difference-between-signatures-and-vrf)
  - Solution
    - Fully distributed VRF. Decentralised Random Beacons  
- `KDF` [Key derivation function](https://en.wikipedia.org/wiki/Key_derivation_function)
  - Input: Random input(Dont need to be uniformly random)
  - Output: Uniformly Random number
  - Cannot generate too much output
  - Derive multiple secrets from one secret.
  - Deterministic
  - Salt
    - Public
    - Domain Separation   
  - `HKDF` [HMAC-based key derivation function](https://en.wikipedia.org/wiki/HKDF)
    - Parts
      - HKDF-Extract
      - HKDF-Expand
    - can use HMAC, with key as input and salt as key
    - can use XOF (Extended output function)
- Key management
  - Key rotation
  - Key revocation
  - Key stores / Key chains / Cloud key management services
- Threshold cryptography
  - Objective
    - Decentralize trust
  - Algorithm
    - `SSS` Shamir secret sharing
      - Reconstruction of private key at dealer will lead to single point of failure
    - Aggregated signatures
    - `DKG` Distributed key generation
:::

### `TLS` Transport layer security
:::info
#### a.k.a
  - `SSL` Secure socket layer
#### Life Cycle
  - Handshake
    - Key exchange
      - negotiate what kind of algorithms will be used
        - ClientHello        
            - key exchange
            - digital signature
            - hash function (unrelated to digital signature)
            - authenticated encryption
        - ServerHello
        - HelloRetryRequest
    - Authentication
      - Finished Message (contains authentication tag that hash all message by HMAC)
  - Post handshake
      - Session resumption
        - PSK - pre-shared key
#### Mutually-authenticated TLS
#### PKI Public key infrastructure
  - CA - Certificate Authority
    - Root CA
    - Intermediate CA
  - Leaf Certificate
  - X.509 Certificate
  - Misbehaving CA
    - Certificate / Public Key Pinning 
    - Certificate Revocation List
    - OCSP - Online Certificate Status Protocol
    - OCSP stapling
:::

### Email
:::info
- `PGP` [Pretty Good Privacy](https://en.wikipedia.org/wiki/Pretty_Good_Privacy)
- `S/MIME` [Secure/Multipurpose Internet Mail Extensions](https://en.wikipedia.org/wiki/S/MIME)
- `SMTP` [Simple Mail Transfer Protocol](https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol)
:::

### Signal Protocol
:::info
#### Trust
  - TOFU - trust on first use
#### Mechanism
  - `X3DH` Extended Triple Diffie-Hellman (Handshake, forward secrecy every conversation)
  - Symmetric ratchet (Post-handshake, forward secrecy every single message)
  - DH ratchet (Post-compromise security)
#### Future
  - Group messaging
    - Client-side fanout
    - Server-side fanout
  - Multiple device
  - Better security assurance than TOFU
    - Most user do not verify fingerprints in TOFU
:::
## Vocabuary

- **Forge** a signature                                
- **Impersonate** someone                              
- **Tamper** the message
- **Thrawt** attacks
- **Hijack** connection
- The key is **compromised**                            
- Security via **obscurity**                           
- **Encrypt** a **plain text**                         
- **Decrypt** a **cipher text**                        
- **Sign** the message                                 
- **Verify** the signature                             

## Please note

- Never hash with SHA2, especially on MAC or secret. Use HMAC always.
- Asymmetric Encryption encrypts data of limited size (e.g. at most 245 byte for RSA PKCS#1 v1.5 with 2048 bit key). That is why hybrid encryption is needed.
- Below is the process of using asymmetric cryptography.
    - **Key exchange** between sender A and receiver B
      - A generates key pair, B generates key pair. or using DH or ECDH.
      - A and B sends each other their own public key. A holds B's public key. B holds A's public key. 
      - Private key will be kept by yourself, and never be sent to anyone.
    - **Encrypt and Sign** By A
      - A encrypts plain text (The target is usually small size symmetric key, which will then become hybrid encryption) with B's public key to produce cipher text.
      - A signs something (depends on the protocol) with A's private key to produce digital signature. 
    - A sends B **cipher text** and **signature**.
    - **Decrypt and Verify** By B   
      - B verifies the signature with A's public key.
      - B decrypts the cipher text with B's private key to produce plain text.   